name: Create PR to update collections

 on:
   pull_request:
   push:
     branches:
       - master

 jobs:
   update-collection:
     runs-on: ubuntu-latest
     steps:
       - name: Checkout code
         uses: actions/checkout@v2

       # Cache node modules and next folder
       - name: ðŸ“¬ Caching
         uses: actions/cache@v3
         working-directory: scripts
         with:
           path: |
             node_modules
           key: ${{ runner.os }}-modules-${{ hashFiles('package-lock.json') }}

       - name: Use Node.js LTS
         uses: actions/setup-node@v2
         with:
           node-version: lts/*

       - name: ðŸ§° Install dependencies
         working-directory: scripts
         run: npm install

       - name: ðŸ§¹ Run update collections
         working-directory: scripts
         run: node updateCollections.js

       - name: Add changes to collections
         run: |
         if [ -z "$(git status --porcelain)" ]; then 
           # Working directory clean, we're done
         else 
           # Uncommitted changes, commit and create branch
           git checkout -b $(date +'%Y-%m-%d')-update-collections
           git add static/collections.json
           git commit -m "static: update collections.json"
           gh pr create --title "Update collections" --base main --body 'Created by Github Actions'
         fi